<!DOCTYPE html>
<!-- Based on Basically Basic Jekyll Theme 1.4.4 created by Michael Rose - mademistakes.com | @mmistakes Free for personal and commercial use under the MIT license https://github.com/mmistakes/jekyll-theme-basically-basic/blob/master/LICENSE -->
<html lang="{{ page.lang | default: site.lang | default: 'en-US' }}" class="no-js">
  {% include head.html %}

  <body class="layout--{{ page.layout | default: layout.layout }}{% if page.classes or layout.classes %}{{ page.classes | default: layout.classes | join: ' ' | prepend: ' ' }}{% endif %} {{ page.title | slugify }}">

    {% include skip-links.html %}

    <div class="sidebar-toggle-wrapper">
      {% if site.search %}
        <button class="search-toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <title>{{ site.data.theme.t.search | default: 'Search' }}</title>
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
      {% endif %}

      <button class="toggle navicon-button larr" type="button">
        <span class="toggle-inner">
          <span class="sidebar-toggle-label visually-hidden">{{ site.data.theme.t.menu | default: 'Menu' }}</span>
          <span class="navicon"></span>
        </span>
      </button>
    </div>

    <div id="sidebar" class="sidebar">
      <div class="inner">
        {% include navigation.html %}
        {% include contact-list.html %}
      </div>
    </div>

    <h1>Preview Data from Sitemap</h1>
    <button onclick="displayPreviewData()">Fetch Data</button>
    <table>
      <thead>
        <tr>
          <th>URL</th>
          <th>Total Views</th>
          <th>Today's Views</th>
          <th>Weekly Views</th>
          <th>Monthly Views</th>
        </tr>
      </thead>
      <tbody id="data-table"></tbody>
    </table>
    
    <script>
      // Fetch the URLs from the sitemap
      async function fetchURLsFromSitemap(sitemapUrl) {
        let response = await fetch(sitemapUrl);
        let text = await response.text();
        let parser = new DOMParser();
        let xmlDoc = parser.parseFromString(text, "text/xml");
    
        let urls = Array.from(xmlDoc.querySelectorAll("url loc")).map(
          (node) => node.textContent
        );
        return urls;
      }
    
      // Fetch preview data from the API for a specific URL
      async function fetchPreviewData(url) {
        const adjustedUrl = `https://hits.sh/api/urns/${encodeURIComponent(url)}`;
        const response = await fetch(adjustedUrl);
        const data = await response.json();
    
        // Find today's views
        const today = new Date().toISOString().slice(0, 10); // "YYYY-MM-DD"
        const todayData = data.items.find((d) => d.from <= today && today <= d.to);
        const todayViews = todayData
          ? todayData.data.find((d) => d.day === today).value
          : 0;
    
        return {
          url,
          totalViews: data.total,
          todayViews,
          weeklyViews: data.weekly,
          monthlyViews: data.monthly,
        };
      }
    
      // Fetch sitemap and preview data, then display in table
      async function displayPreviewData() {
        const sitemapUrl = "https://vadimnastoyashchy.github.io/sitemap.xml";
        const urls = await fetchURLsFromSitemap(sitemapUrl);
        const tableBody = document.getElementById("data-table");
        tableBody.innerHTML = ""; // Clear previous results
    
        for (let url of urls) {
          const previewData = await fetchPreviewData(url);
    
          let row = `<tr>
                        <td>${previewData.url}</td>
                        <td>${previewData.totalViews}</td>
                        <td>${previewData.todayViews}</td>
                        <td>${previewData.weeklyViews}</td>
                        <td>${previewData.monthlyViews}</td>
                    </tr>`;
    
          tableBody.innerHTML += row;
        }
      }
    </script>
    
    {% include back-to-top.html %}
    {% include footer.html %}
    {% include scripts.html %}

  </body>

</html>
